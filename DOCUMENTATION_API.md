# Documentation API - Guia Completo

> **Resumo**: Sistema de API para fornecer documenta√ß√£o da arquitetura em formato consum√≠vel por IAs e ferramentas automatizadas.

## üìã Vis√£o Geral

Este projeto agora inclui endpoints de API dedicados para fornecer documenta√ß√£o da arquitetura de forma program√°tica. A solu√ß√£o foi projetada especificamente para ser consumida por agentes de IA (como Claude, GPT) e ferramentas automatizadas.

### Caracter√≠sticas Principais

‚úÖ **Documenta√ß√£o sempre acess√≠vel** via API HTTP
‚úÖ **Formato Markdown** para f√°cil consumo por IAs
‚úÖ **Gera√ß√£o din√¢mica** baseada no c√≥digo atual
‚úÖ **Scripts de valida√ß√£o** para manter docs atualizados
‚úÖ **Exemplos pr√°ticos** de integra√ß√£o

---

## üöÄ Endpoints Dispon√≠veis

### 1. GET /api/docs/architecture

Retorna o arquivo `API_ARCHITECTURE.md` completo em formato Markdown.

**Uso:**
```bash
curl http://localhost:3000/api/docs/architecture
```

**Resposta:**
- Content-Type: `text/markdown`
- Body: Conte√∫do completo do arquivo API_ARCHITECTURE.md

**Para que serve:**
- IAs precisando de contexto sobre a API
- Ferramentas de documenta√ß√£o automatizadas
- Sistemas de integra√ß√£o externos
- Gera√ß√£o de c√≥digo baseada em LLMs

---

### 2. GET /api/docs/generate

Gera documenta√ß√£o dinamicamente escaneando o c√≥digo atual.

**Uso:**
```bash
curl http://localhost:3000/api/docs/generate
```

**Resposta:**
- Content-Type: `application/json`
- Body: Objeto com metadados da documenta√ß√£o

**Estrutura da Resposta:**
```json
{
  "generatedAt": "2025-10-30T13:00:00.000Z",
  "endpoints": [
    {
      "method": "GET",
      "path": "/transactions",
      "file": "transactions.get.ts",
      "description": "...",
      "queryParams": ["person", "startDate", "endDate"]
    }
  ],
  "utilities": [
    {
      "file": "googleSheets.ts",
      "path": "server/utils/googleSheets.ts",
      "functions": ["fetchTransactionsFromGoogleSheets"]
    }
  ],
  "types": {
    "interfaces": [
      {
        "name": "Transaction",
        "fields": ["transactionId: string", "date: string", ...]
      }
    ]
  },
  "architecture": {
    "layers": [...]
  },
  "markdown": "# API Architecture Documentation..."
}
```

**Para que serve:**
- Verificar se documenta√ß√£o est√° atualizada
- Descobrir endpoints automaticamente
- Auditar estrutura do c√≥digo
- Gerar refer√™ncia de API automaticamente

---

## üõ†Ô∏è Scripts de Manuten√ß√£o

### Verificar Documenta√ß√£o

```bash
npm run docs:check
```

Valida que `API_ARCHITECTURE.md` existe e cont√©m todas as se√ß√µes esperadas.

**Sa√≠da:**
```
üìö API Documentation Tool

‚úÖ API_ARCHITECTURE.md exists
üìÑ File size: 12.34 KB
‚úÖ Documentation appears complete

üí° To generate updated documentation, run: npm run docs:generate
```

---

### Gerar Preview da Documenta√ß√£o

```bash
npm run docs:generate
```

Inicia o servidor dev, gera documenta√ß√£o dinamicamente e exibe preview no console.

**O que faz:**
1. Inicia servidor de desenvolvimento
2. Chama endpoint `/api/docs/generate`
3. Exibe estat√≠sticas e preview
4. Para o servidor automaticamente

**Sa√≠da:**
```
üìö API Documentation Tool

üîß Starting dev server to generate documentation...

‚úÖ Dev server started

üîç Fetching generated documentation...
‚úÖ Documentation generated successfully

üìä Summary:
   - Endpoints: 3
   - Utilities: 4
   - Type Interfaces: 5
   - Generated at: 30/10/2025, 10:00:00

üìù Preview (Markdown):
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# API Architecture Documentation (Auto-Generated)
...
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

üí° To update API_ARCHITECTURE.md, run: npm run docs:update
```

---

### Instru√ß√µes de Atualiza√ß√£o

```bash
npm run docs:update
```

Exibe instru√ß√µes para atualizar manualmente a documenta√ß√£o.

**Por que manual?**
- `API_ARCHITECTURE.md` √© mais completo e detalhado
- Inclui explica√ß√µes e contexto que n√£o podem ser gerados automaticamente
- Use a documenta√ß√£o gerada como **refer√™ncia**, mas mantenha qualidade manual

---

## üìù Workflow de Atualiza√ß√£o

Quando fizer mudan√ßas na API, siga este workflow:

```bash
# 1. Fa√ßa suas mudan√ßas no c√≥digo
# Exemplo: editar server/api/transactions.get.ts

# 2. Verifique status da documenta√ß√£o
npm run docs:check

# 3. Gere preview da documenta√ß√£o atualizada
npm run docs:generate

# 4. Revise a documenta√ß√£o gerada
# Compare com API_ARCHITECTURE.md

# 5. Atualize API_ARCHITECTURE.md manualmente
# Use a documenta√ß√£o gerada como refer√™ncia

# 6. Verifique se ficou completo
npm run docs:check

# 7. Commit c√≥digo e documenta√ß√£o juntos
git add server/ API_ARCHITECTURE.md
git commit -m "feat: novo endpoint com documenta√ß√£o"
```

---

## ü§ñ Exemplos de Integra√ß√£o

### Exemplo 1: Consumo B√°sico com Node.js

```javascript
// Buscar documenta√ß√£o completa
const response = await fetch('http://localhost:3000/api/docs/architecture')
const markdown = await response.text()
console.log(markdown)

// Buscar metadata din√¢mica
const genResponse = await fetch('http://localhost:3000/api/docs/generate')
const data = await genResponse.json()
console.log(`Endpoints: ${data.endpoints.length}`)
```

### Exemplo 2: Script Completo

Veja o arquivo `examples/ai-documentation-consumer.js` para um exemplo completo de:
- Buscar documenta√ß√£o
- Analisar endpoints
- Verificar cobertura
- Pesquisar informa√ß√µes espec√≠ficas

```bash
# Execute o exemplo (com servidor rodando)
node examples/ai-documentation-consumer.js
```

### Exemplo 3: Uso com IA

```bash
# Salvar documenta√ß√£o para contexto de IA
curl http://localhost:3000/api/docs/architecture > api-context.md

# Usar com Claude, GPT, etc.
# "Aqui est√° a documenta√ß√£o da API: [colar conte√∫do]"
# "Com base nisso, me ajude a criar um novo endpoint..."
```

### Exemplo 4: CI/CD Validation

```bash
#!/bin/bash
# Script de valida√ß√£o para CI/CD

echo "Verificando documenta√ß√£o..."
npm run docs:check

if [ $? -ne 0 ]; then
  echo "‚ùå Documenta√ß√£o est√° incompleta ou ausente"
  exit 1
fi

echo "‚úÖ Documenta√ß√£o validada com sucesso"
```

---

## üìÅ Arquivos Criados

### Endpoints da API

1. **`server/api/docs/architecture.get.ts`**
   - Endpoint que retorna API_ARCHITECTURE.md
   - Content-Type: text/markdown
   - L√™ arquivo do disco e retorna conte√∫do

2. **`server/api/docs/generate.get.ts`**
   - Endpoint de gera√ß√£o din√¢mica
   - Escaneia c√≥digo atual
   - Retorna metadata em JSON
   - Gera markdown automaticamente

### Scripts de Manuten√ß√£o

3. **`scripts/update-docs.mjs`**
   - Script Node.js para manuten√ß√£o de documenta√ß√£o
   - Comandos: check, generate, update
   - Gerencia servidor dev automaticamente
   - Valida√ß√£o e preview

### Documenta√ß√£o

4. **`server/api/docs/README.md`**
   - Documenta√ß√£o completa dos endpoints
   - Exemplos de uso
   - Troubleshooting
   - Melhores pr√°ticas

5. **`DOCUMENTATION_API.md`** (este arquivo)
   - Guia completo da solu√ß√£o
   - Workflow de atualiza√ß√£o
   - Exemplos de integra√ß√£o

### Exemplos

6. **`examples/ai-documentation-consumer.js`**
   - Exemplo completo de consumo
   - An√°lise autom√°tica
   - Verifica√ß√£o de cobertura
   - Pesquisa em documenta√ß√£o

---

## üéØ Quando Atualizar a Documenta√ß√£o

Atualize `API_ARCHITECTURE.md` sempre que:

### 1. Adicionar Novos Endpoints

Quando criar `server/api/novo-endpoint.get.ts`:

- [ ] Documentar caminho e m√©todo HTTP
- [ ] Listar todos os query parameters
- [ ] Fornecer exemplos de requests
- [ ] Descrever estrutura da resposta

### 2. Adicionar Utilities

Quando criar `server/utils/nova-utility.ts`:

- [ ] Documentar fun√ß√µes exportadas
- [ ] Descrever prop√≥sito e uso
- [ ] Atualizar camadas de arquitetura se necess√°rio

### 3. Modificar Types

Quando alterar `types/transaction.ts`:

- [ ] Atualizar tabela de par√¢metros
- [ ] Adicionar exemplos com novos par√¢metros
- [ ] Documentar regras de valida√ß√£o

### 4. Mudar Arquitetura

Quando mudar fluxo de dados:

- [ ] Atualizar diagramas de arquitetura
- [ ] Revisar se√ß√£o de data flow
- [ ] Atualizar exemplos de migra√ß√£o

---

## ‚úÖ Melhores Pr√°ticas

### 1. Mantenha Sincronizado
```bash
# Sempre antes de commit
npm run docs:check
```

### 2. Use Exemplos Reais
```typescript
// ‚úÖ BOM - exemplo testado
GET /api/transactions?person=Gabriel&startDate=2025-01-01

// ‚ùå RUIM - exemplo gen√©rico
GET /api/transactions?param=value
```

### 3. Seja Espec√≠fico
```markdown
‚úÖ BOM: "Retorna array de Transaction objects com campo person populated"
‚ùå RUIM: "Retorna dados filtrados"
```

### 4. Documente Comportamento Atual
```markdown
‚úÖ BOM: "Installment processing is enabled by default (processInstallments=true)"
‚ùå RUIM: "Installment processing pode ser habilitado"
```

### 5. Formato Amig√°vel para IA
- Use markdown estruturado
- Headers claros (##, ###)
- Code blocks com linguagem especificada
- Exemplos pr√°ticos e completos

---

## üîÆ Melhorias Futuras

Poss√≠veis evolu√ß√µes do sistema:

### Automa√ß√£o
- [ ] Git pre-commit hook para validar documenta√ß√£o
- [ ] Gera√ß√£o autom√°tica de changelog
- [ ] CI/CD check para sincroniza√ß√£o

### Formatos
- [ ] Gera√ß√£o de OpenAPI/Swagger spec
- [ ] Suporte a m√∫ltiplos formatos de sa√≠da (JSON, YAML, HTML)
- [ ] Versioning de documenta√ß√£o

### Performance
- [ ] Cache com ETag
- [ ] Invalida√ß√£o autom√°tica quando c√≥digo muda
- [ ] CDN para documenta√ß√£o est√°tica

### Integra√ß√£o
- [ ] Webhook para notificar quando docs ficam desatualizados
- [ ] Dashboard de cobertura de documenta√ß√£o
- [ ] Diff endpoint para comparar vers√µes

---

## üÜò Troubleshooting

### Erro 500 ao acessar /api/docs/architecture

**Causa**: Arquivo API_ARCHITECTURE.md n√£o encontrado

**Solu√ß√£o**:
```bash
# Verificar se arquivo existe
ls -la API_ARCHITECTURE.md

# Se n√£o existir, criar a partir do template
npm run docs:generate
```

### Documenta√ß√£o gerada est√° incompleta

**Causa**: Endpoints n√£o seguem conven√ß√£o de nomenclatura

**Solu√ß√£o**:
```bash
# Verificar naming dos arquivos
ls -la server/api/**/*.ts

# Devem ser: *.get.ts, *.post.ts, *.put.ts, etc.
```

### Script docs:generate falha

**Causa**: Servidor n√£o iniciou a tempo

**Solu√ß√£o**:
- Aguardar mais tempo para servidor iniciar
- Verificar se porta 3000 est√° dispon√≠vel
- Executar manualmente: `npm run dev` e depois testar endpoint

---

## üìö Documenta√ß√£o Relacionada

- **[API_ARCHITECTURE.md](./API_ARCHITECTURE.md)** - Documenta√ß√£o completa da API
- **[CLAUDE.md](./CLAUDE.md)** - Contexto do projeto e guidelines
- **[README.md](./README.md)** - Setup e vis√£o geral do projeto
- **[server/api/docs/README.md](./server/api/docs/README.md)** - Detalhes t√©cnicos dos endpoints

---

## üéì Resumo R√°pido

**Para consumir a documenta√ß√£o:**
```bash
curl http://localhost:3000/api/docs/architecture
```

**Para verificar se est√° atualizada:**
```bash
npm run docs:check
```

**Para gerar preview:**
```bash
npm run docs:generate
```

**Para usar em IA:**
1. Inicie o servidor: `npm run dev`
2. Baixe a documenta√ß√£o: `curl http://localhost:3000/api/docs/architecture > context.md`
3. Forne√ßa para a IA junto com sua pergunta

**Workflow completo:**
```bash
# 1. Alterar c√≥digo
vim server/api/transactions.get.ts

# 2. Validar
npm run docs:check

# 3. Ver o que mudou
npm run docs:generate

# 4. Atualizar docs manualmente
vim API_ARCHITECTURE.md

# 5. Verificar novamente
npm run docs:check

# 6. Commit
git add . && git commit -m "feat: novo endpoint + docs"
```

---

**Pronto!** Agora voc√™ tem um sistema completo de documenta√ß√£o consum√≠vel por IAs e ferramentas automatizadas, com instru√ß√µes claras para mant√™-lo sempre atualizado. üöÄ

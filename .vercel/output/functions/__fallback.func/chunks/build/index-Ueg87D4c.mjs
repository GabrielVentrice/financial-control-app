import{b as e,a as t,u as a}from"./server.mjs";import{defineComponent as s,computed as r,mergeProps as n,unref as o,withCtx as l,createVNode as i,readonly as d,toRef as c,isRef as p,useSSRContext as u}from"vue";import{ssrRenderAttrs as g,ssrInterpolate as m,ssrIncludeBooleanAttr as x,ssrRenderList as v,ssrRenderClass as b,ssrRenderComponent as y,ssrRenderStyle as f}from"vue/server-renderer";import{Bar as h}from"vue-chartjs";import{Chart as w,Title as $,Tooltip as D,Legend as M,BarElement as S,CategoryScale as C,LinearScale as T}from"chart.js";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/utils";import"unhead/plugins";import"vue-router";function useState(...e){const t="string"==typeof e[e.length-1]?e.pop():void 0;"string"!=typeof e[0]&&e.unshift(t);const[s,r]=e;if(!s||"string"!=typeof s)throw new TypeError("[nuxt] [useState] key must be a string: "+s);if(void 0!==r&&"function"!=typeof r)throw new Error("[nuxt] [useState] init must be a function: "+r);const n="$s"+s,o=a(),l=c(o.payload.state,n);if(void 0===l.value&&r){const e=r();if(p(e))return o.payload.state[n]=e,e;l.value=e}return l}const A=s({__name:"index",__ssrInlineRender:!0,setup(a){w.register($,D,M,S,C,T);const{transactions:s,loading:c,error:p}=(()=>{const e=useState("transactions",()=>[]),t=useState("transactions-loading",()=>!1),a=useState("transactions-error",()=>null);return{transactions:d(e),loading:d(t),error:d(a),fetchTransactions:async s=>{t.value=!0,a.value=null;try{const t=new URLSearchParams;(null==s?void 0:s.person)&&t.append("person",s.person),(null==s?void 0:s.startDate)&&t.append("startDate",s.startDate),(null==s?void 0:s.endDate)&&t.append("endDate",s.endDate),(null==s?void 0:s.searchTerm)&&t.append("searchTerm",s.searchTerm),(null==s?void 0:s.origin)&&t.append("origin",s.origin),(null==s?void 0:s.destination)&&t.append("destination",s.destination),void 0!==(null==s?void 0:s.processInstallments)&&t.append("processInstallments",String(s.processInstallments));const a=t.toString()?`/api/transactions?${t.toString()}`:"/api/transactions",r=await $fetch(a);e.value=r}catch(e){a.value=e.message||"Erro ao carregar transações",console.error("Erro ao buscar transações:",e)}finally{t.value=!1}},getTransactionsByDateRange:(t,a)=>e.value.filter(e=>{const s=new Date(e.date),r=new Date(t),n=new Date(a);return s>=r&&s<=n}),getTotalAmount:t=>(t||e.value).reduce((e,t)=>e+t.amount,0),getTransactionsByOrigin:t=>e.value.filter(e=>e.origin.toLowerCase().includes(t.toLowerCase())),getTransactionsByDescription:t=>e.value.filter(e=>e.description.toLowerCase().includes(t.toLowerCase()))}})(),{selectedPerson:u}=e(),{getCurrentMonthStats:A,getTopCategories:j,getUpcomingExpenses:F,generateAlerts:R,getMonthlyForecast:k}=(()=>{const isExpense=e=>{const t=e.origin.toLowerCase();return t.includes("bank account")||t.includes("credit card")},getCurrentMonthStats=e=>{const t=new Date,a=t.getMonth(),s=t.getFullYear(),r=e.filter(e=>{const t=new Date(e.date);return t.getMonth()===a&&t.getFullYear()===s}),n=r.filter(e=>e.destination.toLowerCase().includes("bank account")).reduce((e,t)=>e+Math.abs(t.amount),0),o=r.filter(e=>isExpense(e)).reduce((e,t)=>e+Math.abs(t.amount),0);return{income:n,expenses:o,balance:n-o,transactionCount:r.length}},getUpcomingExpenses=e=>{const t=new Date,a=new Date(t);return a.setMonth(a.getMonth()+1),e.filter(e=>{const s=new Date(e.date);return s>t&&s<=a&&isExpense(e)}).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())};return{getCurrentMonthStats:getCurrentMonthStats,getTopCategories:(e,t=5)=>{const a=new Date,s=a.getMonth(),r=a.getFullYear(),n=e.filter(e=>{const t=new Date(e.date);return t.getMonth()===s&&t.getFullYear()===r&&isExpense(e)}),o=new Map;n.forEach(e=>{const t=e.destination||"Sem categoria",a=o.get(t)||{total:0,count:0};o.set(t,{total:a.total+Math.abs(e.amount),count:a.count+1})});const l=Array.from(o.values()).reduce((e,t)=>e+t.total,0);return Array.from(o.entries()).map(([e,t])=>({name:e,total:t.total,count:t.count,percentage:l>0?t.total/l*100:0})).sort((e,t)=>t.total-e.total).slice(0,t)},getUpcomingExpenses:getUpcomingExpenses,generateAlerts:e=>{const t=[],a=new Date,s=a.getMonth(),r=a.getFullYear(),n=getCurrentMonthStats(e),o=e.filter(e=>{const t=new Date(e.date),a=0===s?11:s-1,n=0===s?r-1:r;return t.getMonth()===a&&t.getFullYear()===n}).filter(e=>isExpense(e)).reduce((e,t)=>e+Math.abs(t.amount),0);o>0&&n.expenses>1.2*o&&t.push({type:"warning",title:"Gastos Acima do Esperado",message:"Seus gastos estão 20% acima do mês passado",amount:n.expenses-o});const l=e.filter(e=>{const t=new Date(e.date);return t.getMonth()===s&&t.getFullYear()===r&&Math.abs(e.amount)>1e3});l.length>0&&t.push({type:"info",title:"Transações de Alto Valor",message:`${l.length} transação(ões) acima de R$ 1.000`,amount:l.reduce((e,t)=>e+Math.abs(t.amount),0)}),n.balance<0&&t.push({type:"danger",title:"Saldo Negativo",message:"Suas despesas estão maiores que sua receita este mês",amount:Math.abs(n.balance)});const i=new Date(r,s+1,0).getDate(),d=a.getDate(),c=d/i*20;return n.transactionCount<.5*c&&d>10&&t.push({type:"warning",title:"Poucas Transações Registradas",message:"Você pode ter transações não registradas este mês"}),t},getMonthlyForecast:e=>{const t=new Date,a=new Date(t);a.setMonth(a.getMonth()+1);const s=getUpcomingExpenses(e),r=s.reduce((e,t)=>e+Math.abs(t.amount),0),n=getCurrentMonthStats(e),o=new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),l=t.getDate(),i=l>5?n.income/l*o:n.income;return{projectedIncome:i,upcomingExpenses:r,projectedBalance:i-r,upcomingCount:s.length}}}})(),E=r(()=>{let e=s.value;return"Ambos"!==u.value&&(e=e.filter(e=>e.person===u.value)),e}),L=r(()=>A(E.value)),B=r(()=>j(E.value,5)),P=r(()=>F(E.value)),Y=r(()=>R(E.value)),I=r(()=>k(E.value)),_=r(()=>({labels:["Receitas","Despesas"],datasets:[{label:"Valores do Mês",data:[L.value.income,L.value.expenses],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgb(34, 197, 94)","rgb(239, 68, 68)"],borderWidth:2}]})),V={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>formatCurrency(e.parsed.y)}}},scales:{y:{beginAtZero:!0,ticks:{callback:e=>"R$ "+e.toLocaleString("pt-BR")}}}},formatCurrency=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e);return(e,a,s,r)=>{const d=t;a(`<div${g(n({class:"min-h-screen bg-gray-50"},r))}><div class="bg-gradient-to-r from-primary-600 to-primary-700 shadow-lg"><div class="px-8 py-8"><div class="flex items-center justify-between"><div><h1 class="text-3xl font-bold text-white">Dashboard Financeiro</h1><p class="text-primary-100 mt-1">${m(["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"][(new Date).getMonth()])} - Visão geral rápida</p></div><button${x(o(c))?" disabled":""} class="px-6 py-2 bg-white text-primary-700 rounded-lg hover:bg-primary-50 transition-colors disabled:bg-gray-400 disabled:text-gray-600 font-medium shadow-md">${m(o(c)?"Atualizando...":"Atualizar")}</button></div></div></div>`),o(c)?a('<div class="px-8 py-12 text-center"><div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"></div><p class="mt-4 text-gray-600">Carregando dados financeiros...</p></div>'):a("\x3c!----\x3e"),o(p)?a(`<div class="px-8 pt-8"><div class="bg-red-50 border border-red-200 rounded-lg p-6 text-center"><p class="text-red-800 font-medium">Erro ao carregar dados</p><p class="text-red-600 text-sm mt-2">${m(o(p))}</p></div></div>`):o(c)?a("\x3c!----\x3e"):(a('<div class="px-8 py-8 space-y-6">'),Y.value.length>0?(a('<div class="space-y-3">\x3c!--[--\x3e'),v(Y.value,(e,t)=>{a(`<div class="${b([{"bg-yellow-50 border-yellow-200":"warning"===e.type,"bg-red-50 border-red-200":"danger"===e.type,"bg-blue-50 border-blue-200":"info"===e.type},"border rounded-lg p-4 flex items-start gap-3"])}"><div class="${b([{"text-yellow-600":"warning"===e.type,"text-red-600":"danger"===e.type,"text-blue-600":"info"===e.type},"text-xl mt-0.5"])}">${m("danger"===e.type?"⚠️":"warning"===e.type?"⚡":"ℹ️")}</div><div class="flex-1"><p class="${b([{"text-yellow-900":"warning"===e.type,"text-red-900":"danger"===e.type,"text-blue-900":"info"===e.type},"font-semibold"])}">${m(e.title)}</p><p class="${b([{"text-yellow-700":"warning"===e.type,"text-red-700":"danger"===e.type,"text-blue-700":"info"===e.type},"text-sm mt-1"])}">${m(e.message)} `),e.amount?a(`<span class="font-medium"> (${m(formatCurrency(e.amount))}) </span>`):a("\x3c!----\x3e"),a("</p></div></div>")}),a("\x3c!--]--\x3e</div>")):a("\x3c!----\x3e"),a(`<div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-primary-500"><p class="text-gray-600 text-sm font-medium uppercase tracking-wide">Saldo do Mês</p><p class="${b([{"text-green-600":L.value.balance>=0,"text-red-600":L.value.balance<0},"text-4xl font-bold mt-3"])}">${m(formatCurrency(L.value.balance))}</p><p class="text-gray-500 text-xs mt-2">${m(L.value.transactionCount)} transações </p></div><div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500"><p class="text-gray-600 text-sm font-medium uppercase tracking-wide">Receitas</p><p class="text-4xl font-bold text-green-600 mt-3">${m(formatCurrency(L.value.income))}</p><p class="text-gray-500 text-xs mt-2">Entradas do mês</p></div><div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500"><p class="text-gray-600 text-sm font-medium uppercase tracking-wide">Despesas</p><p class="text-4xl font-bold text-red-600 mt-3">${m(formatCurrency(L.value.expenses))}</p><p class="text-gray-500 text-xs mt-2">Saídas do mês</p></div></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="bg-white rounded-lg shadow-md p-6"><h2 class="text-lg font-bold text-gray-800 mb-4">Receitas vs Despesas</h2><div class="h-64">`),a(y(o(h),{data:_.value,options:V},null,s)),a('</div></div><div class="bg-white rounded-lg shadow-md p-6"><h2 class="text-lg font-bold text-gray-800 mb-4">Top Categorias de Gastos</h2>'),B.value.length>0?(a('<div class="space-y-4">\x3c!--[--\x3e'),v(B.value,e=>{a(`<div class="space-y-2"><div class="flex justify-between items-center"><span class="text-sm font-medium text-gray-700 truncate">${m(e.name)}</span><span class="text-sm font-bold text-gray-900">${m(formatCurrency(e.total))}</span></div><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-primary-600 h-2.5 rounded-full transition-all duration-300" style="${f({width:e.percentage+"%"})}"></div></div><div class="flex justify-between text-xs text-gray-500"><span>${m(e.count)} transações</span><span>${m(e.percentage.toFixed(1))}%</span></div></div>`)}),a("\x3c!--]--\x3e</div>")):a('<div class="text-center py-8 text-gray-500"> Nenhuma categoria de gasto este mês </div>'),a(`</div></div><div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 bg-white rounded-lg shadow-md p-6"><h2 class="text-lg font-bold text-gray-800 mb-4">Previsão Mensal</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><div class="bg-green-50 rounded-lg p-4"><p class="text-sm text-green-700 font-medium">Receita Projetada</p><p class="text-2xl font-bold text-green-600 mt-1">${m(formatCurrency(I.value.projectedIncome))}</p></div><div class="bg-red-50 rounded-lg p-4"><p class="text-sm text-red-700 font-medium">Despesas Futuras</p><p class="text-2xl font-bold text-red-600 mt-1">${m(formatCurrency(I.value.upcomingExpenses))}</p></div><div class="bg-blue-50 rounded-lg p-4"><p class="text-sm text-blue-700 font-medium">Saldo Projetado</p><p class="${b([{"text-green-600":I.value.projectedBalance>=0,"text-red-600":I.value.projectedBalance<0},"text-2xl font-bold mt-1"])}">${m(formatCurrency(I.value.projectedBalance))}</p></div></div>`),P.value.length>0?(a(`<div class="border-t pt-4"><h3 class="text-sm font-semibold text-gray-700 mb-3"> Próximas Despesas (${m(P.value.length)}) </h3><div class="space-y-2 max-h-48 overflow-y-auto">\x3c!--[--\x3e`),v(P.value.slice(0,5),e=>{a(`<div class="flex justify-between items-center text-sm py-2 border-b border-gray-100 last:border-0"><div class="flex-1"><p class="font-medium text-gray-700">${m(e.description)}</p><p class="text-xs text-gray-500">${m((e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("pt-BR")}catch{return e}})(e.date))}</p></div><span class="font-bold text-red-600 ml-4">${m(formatCurrency(Math.abs(e.amount)))}</span></div>`)}),a("\x3c!--]--\x3e</div></div>")):a('<div class="border-t pt-4 text-center text-gray-500 text-sm"> Nenhuma despesa futura programada </div>'),a('</div><div class="bg-white rounded-lg shadow-md p-6"><h2 class="text-lg font-bold text-gray-800 mb-4">Ações Rápidas</h2><div class="space-y-3">'),a(y(d,{to:"/transactions",class:"flex items-center gap-3 p-4 bg-primary-50 hover:bg-primary-100 rounded-lg transition-colors border border-primary-200"},{default:l((e,t,a,s)=>{if(!t)return[i("div",{class:"text-2xl"},"📝"),i("div",null,[i("p",{class:"font-semibold text-primary-900 text-sm"},"Ver Transações"),i("p",{class:"text-xs text-primary-700"},"Lista completa")])];t(`<div class="text-2xl"${s}>📝</div><div${s}><p class="font-semibold text-primary-900 text-sm"${s}>Ver Transações</p><p class="text-xs text-primary-700"${s}>Lista completa</p></div>`)}),_:1},s)),a(y(d,{to:"/categories",class:"flex items-center gap-3 p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors border border-purple-200"},{default:l((e,t,a,s)=>{if(!t)return[i("div",{class:"text-2xl"},"📊"),i("div",null,[i("p",{class:"font-semibold text-purple-900 text-sm"},"Categorias"),i("p",{class:"text-xs text-purple-700"},"Análise detalhada")])];t(`<div class="text-2xl"${s}>📊</div><div${s}><p class="font-semibold text-purple-900 text-sm"${s}>Categorias</p><p class="text-xs text-purple-700"${s}>Análise detalhada</p></div>`)}),_:1},s)),a(y(d,{to:"/installments",class:"flex items-center gap-3 p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition-colors border border-orange-200"},{default:l((e,t,a,s)=>{if(!t)return[i("div",{class:"text-2xl"},"💳"),i("div",null,[i("p",{class:"font-semibold text-orange-900 text-sm"},"Parcelamentos"),i("p",{class:"text-xs text-orange-700"},"Timeline e análise")])];t(`<div class="text-2xl"${s}>💳</div><div${s}><p class="font-semibold text-orange-900 text-sm"${s}>Parcelamentos</p><p class="text-xs text-orange-700"${s}>Timeline e análise</p></div>`)}),_:1},s)),a(`<button class="w-full flex items-center gap-3 p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200"><div class="text-2xl">🔄</div><div class="text-left"><p class="font-semibold text-gray-900 text-sm">Atualizar Dados</p><p class="text-xs text-gray-700">Sincronizar planilha</p></div></button></div><div class="mt-6 p-3 bg-gray-50 rounded-lg border border-gray-200"><p class="text-xs font-medium text-gray-600 mb-1">Filtro Atual:</p><span class="inline-block px-3 py-1 bg-primary-100 text-primary-800 rounded-full text-sm font-semibold">${m(o(u))}</span></div></div></div></div>`)),a("</div>")}}}),j=A.setup;A.setup=(e,t)=>{const a=u();return(a.modules||(a.modules=new Set)).add("pages/index.vue"),j?j(e,t):void 0};export{A as default};

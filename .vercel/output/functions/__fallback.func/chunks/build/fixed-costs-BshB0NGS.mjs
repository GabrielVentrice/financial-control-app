import{defineComponent as t,ref as e,computed as s,mergeProps as a,unref as r,useSSRContext as o}from"vue";import{ssrRenderAttrs as i,ssrInterpolate as n,ssrIncludeBooleanAttr as l,ssrRenderList as d,ssrRenderComponent as c,ssrRenderClass as p}from"vue/server-renderer";import{Bar as u}from"vue-chartjs";import{Chart as g,CategoryScale as x,LinearScale as m,BarElement as v,Title as y,Tooltip as h,Legend as b}from"chart.js";import{b as f}from"./server.mjs";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/utils";import"unhead/plugins";import"vue-router";const w=t({__name:"fixed-costs",__ssrInlineRender:!0,setup(t){g.register(x,m,v,y,h,b);const{selectedPerson:o}=f();e([]);const w=e([]),$=e(!1),C=e(null),k=["Installments/Financing","Rent","Financing","Subscriptions/Softwares","Utilities","Business & Taxes","Investments","Insurance","Medical"],F=(()=>{const t=[],e=new Date;for(let s=5;s>=0;s--){const a=new Date(e.getFullYear(),e.getMonth()-s,1),r=a.getFullYear(),o=String(a.getMonth()+1).padStart(2,"0");t.push(`${r}-${o}`)}return t})(),formatMonthLabel=t=>{const[e,s]=t.split("-");return new Date(parseInt(e),parseInt(s)-1).toLocaleDateString("pt-BR",{month:"short",year:"2-digit"})},S=s(()=>F.map(formatMonthLabel)),I=s(()=>{let t=w.value;return"Ambos"!==o.value&&(t=t.filter(t=>t.person===o.value)),t}),D=s(()=>I.value.filter(t=>(t=>{const e=t.toLowerCase();return k.some(t=>e.includes(t.toLowerCase()))})(t.destination||"Sem Categoria"))),R=s(()=>{const t={};return F.forEach(e=>{const s=(t=>{const[e,s]=t.split("-");return D.value.filter(t=>{const a=new Date(t.date);return a.getFullYear()===parseInt(e)&&a.getMonth()===parseInt(s)-1})})(e);t[e]=s.reduce((t,e)=>t+e.amount,0)}),t}),T=s(()=>{const t=F[F.length-1];return R.value[t]||0}),M=s(()=>{const t=F[F.length-1],[e,s]=t.split("-");return new Date(parseInt(e),parseInt(s)-1).toLocaleDateString("pt-BR",{month:"long",year:"numeric"})}),A=s(()=>Object.values(R.value).reduce((t,e)=>t+e,0)/F.length),E=s(()=>Object.values(R.value).reduce((t,e)=>t+e,0)),j=s(()=>{const t=new Set;return D.value.forEach(e=>{const s=e.destination||"Sem Categoria";t.add(s)}),t.size}),L=s(()=>{const t=new Map;D.value.forEach(e=>{const s=e.destination||"Sem Categoria",a=new Date(e.date),r=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;if(!F.includes(r))return;t.has(s)||t.set(s,{name:s,monthlyTotals:{},total:0,average:0});const o=t.get(s);o.monthlyTotals[r]=(o.monthlyTotals[r]||0)+e.amount,o.total+=e.amount});const e=[];return t.forEach(t=>{t.average=t.total/F.length,e.push(t)}),e.sort((t,e)=>e.total-t.total)}),B=s(()=>({labels:S.value,datasets:[{label:"Custo Fixo Mensal",data:F.map(t=>R.value[t]||0),backgroundColor:"rgba(249, 115, 22, 0.8)",borderColor:"rgba(249, 115, 22, 1)",borderWidth:2,borderRadius:4}]})),O={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:t=>`Custo: ${formatCurrency(t.parsed.y)}`}}},scales:{y:{beginAtZero:!0,ticks:{callback:t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}}}},formatCurrency=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t);return(t,e,s,g)=>{e(`<div${i(a({class:"min-h-screen bg-gray-50"},g))}><div class="bg-white shadow"><div class="px-8 py-6"><h1 class="text-3xl font-bold text-gray-800">Histórico de Custos Fixos</h1><p class="text-gray-600 mt-1">Análise dos últimos 6 meses de custos fixos</p></div></div><div class="px-8 py-4"><div class="bg-white rounded-lg shadow px-6 py-3"><div class="flex items-center justify-between gap-4 flex-wrap"><div class="flex items-center gap-2 text-sm text-gray-600"><span class="font-medium">Pessoa:</span><span class="px-3 py-1 bg-primary-100 text-primary-800 rounded-full font-medium">${n(r(o))}</span></div><button${l($.value)?" disabled":""} class="px-4 py-1.5 text-sm bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:bg-gray-400">${n($.value?"Carregando...":"Atualizar")}</button></div></div>`),k.length>0?(e(`<div class="mt-3 px-6 py-2 bg-orange-50 border border-orange-200 rounded-lg"><details class="text-sm"><summary class="cursor-pointer text-orange-800 font-medium hover:text-orange-900"> 📌 ${n(k.length)} categoria(s) configurada(s) como custo fixo </summary><div class="mt-2 flex flex-wrap gap-2">\x3c!--[--\x3e`),d(k,t=>{e(`<span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full border border-orange-300">${n(t)}</span>`)}),e('\x3c!--]--\x3e</div><p class="mt-2 text-xs text-orange-700"> Para modificar, edite FIXED_COST_CATEGORIES em pages/fixed-costs.vue </p></details></div>')):e("\x3c!----\x3e"),e("</div>"),$.value?e('<div class="px-8 py-12 text-center"><div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"></div><p class="mt-4 text-gray-600">Carregando dados...</p></div>'):C.value?e(`<div class="px-8 py-12"><div class="bg-red-50 border border-red-200 rounded-lg p-6 text-center"><p class="text-red-800 font-medium">Erro ao carregar dados</p><p class="text-red-600 text-sm mt-2">${n(C.value)}</p></div></div>`):(e(`<div class="px-8 pb-8 space-y-6"><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div class="bg-gradient-to-br from-orange-500 to-orange-700 rounded-lg shadow-lg p-6"><p class="text-white text-sm font-medium uppercase tracking-wide opacity-90">Custo Fixo Atual</p><p class="text-4xl font-bold text-white mt-2">${n(formatCurrency(T.value))}</p><p class="text-orange-100 text-xs mt-2">${n(M.value)}</p></div><div class="bg-white rounded-lg shadow-md p-6"><p class="text-gray-600 text-sm font-medium uppercase tracking-wide">Média Mensal</p><p class="text-3xl font-bold text-gray-900 mt-2">${n(formatCurrency(A.value))}</p><p class="text-gray-500 text-xs mt-2">Últimos 6 meses</p></div><div class="bg-white rounded-lg shadow-md p-6"><p class="text-gray-600 text-sm font-medium uppercase tracking-wide">Categorias Ativas</p><p class="text-3xl font-bold text-gray-900 mt-2">${n(j.value)}</p><p class="text-gray-500 text-xs mt-2">Com gastos no período</p></div></div><div class="bg-white rounded-lg shadow-lg p-6"><h2 class="text-xl font-bold text-gray-800 mb-4">Evolução dos Custos Fixos</h2><div class="h-80">`),B.value?e(c(r(u),{data:B.value,options:O},null,s)):e("\x3c!----\x3e"),e('</div></div><div class="bg-white rounded-lg shadow-lg overflow-hidden"><div class="px-6 py-4 bg-gray-50 border-b border-gray-200"><h2 class="text-xl font-bold text-gray-800">Detalhamento por Categoria</h2><p class="text-sm text-gray-600 mt-1">Gastos mensais por categoria de custo fixo</p></div><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-100"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky left-0 bg-gray-100 z-10"> Categoria </th>\x3c!--[--\x3e'),d(S.value,t=>{e(`<th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">${n(t)}</th>`)}),e('\x3c!--]--\x3e<th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap bg-gray-200"> Total </th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap bg-gray-200"> Média </th></tr></thead><tbody class="bg-white divide-y divide-gray-200">\x3c!--[--\x3e'),d(L.value,t=>{e(`<tr class="hover:bg-gray-50 transition-colors"><td class="px-6 py-4 whitespace-nowrap sticky left-0 bg-white"><div class="flex items-center gap-2"><span class="text-lg">${n((t=>{const e=t.toLowerCase();return e.includes("installment")||e.includes("financing")||e.includes("parcela")?"📅":e.includes("rent")||e.includes("aluguel")?"🏠":e.includes("subscription")||e.includes("software")||e.includes("assinatura")?"💻":e.includes("utilities")||e.includes("utility")||e.includes("água")||e.includes("luz")||e.includes("gas")||e.includes("internet")?"📄":e.includes("business")||e.includes("tax")||e.includes("imposto")?"💼":e.includes("investment")||e.includes("investimento")?"📈":e.includes("insurance")||e.includes("seguro")?"🛡️":"💰"})(t.name))}</span><span class="text-sm font-medium text-gray-900">${n(t.name)}</span></div></td>\x3c!--[--\x3e`),d(S.value,s=>{var a;e(`<td class="${p([(a=t.monthlyTotals[s],a&&0!==a?"text-gray-900 font-medium":"text-gray-400"),"px-6 py-4 whitespace-nowrap text-right text-sm"])}">${n(formatCurrency(t.monthlyTotals[s]||0))}</td>`)}),e(`\x3c!--]--\x3e<td class="px-6 py-4 whitespace-nowrap text-right font-semibold text-sm text-gray-900 bg-gray-50">${n(formatCurrency(t.total))}</td><td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-600 bg-gray-50">${n(formatCurrency(t.average))}</td></tr>`)}),e('\x3c!--]--\x3e<tr class="bg-gray-100 font-bold"><td class="px-6 py-4 whitespace-nowrap sticky left-0 bg-gray-100 text-sm text-gray-900"> TOTAL </td>\x3c!--[--\x3e'),d(S.value,t=>{e(`<td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900">${n(formatCurrency((t=>{const e=S.value.indexOf(t);if(-1===e)return 0;const s=F[e];return R.value[s]||0})(t)))}</td>`)}),e(`\x3c!--]--\x3e<td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900 bg-gray-200">${n(formatCurrency(E.value))}</td><td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900 bg-gray-200">${n(formatCurrency(A.value))}</td></tr></tbody></table></div>`),0===L.value.length?e('<div class="text-center py-12"><p class="text-gray-500">Nenhum custo fixo encontrado nos últimos 6 meses</p></div>'):e("\x3c!----\x3e"),e("</div></div>")),e("</div>")}}}),$=w.setup;w.setup=(t,e)=>{const s=o();return(s.modules||(s.modules=new Set)).add("pages/fixed-costs.vue"),$?$(t,e):void 0};export{w as default};

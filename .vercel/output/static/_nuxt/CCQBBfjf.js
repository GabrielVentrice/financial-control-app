import{C as X,c as q,L as H,B as U,p as W,a as Z,b as J,d as K}from"./CTu12vcL.js";import{m as Q,n as tt,A as b,p as d,q as et,c as l,a as e,s as k,t as n,v as D,F as y,x as h,E as st,o as r,y as at}from"#entry";import{u as ot}from"./BxOt9PVQ.js";const nt={class:"min-h-screen bg-gray-50"},rt={class:"px-8 py-4"},lt={class:"bg-white rounded-lg shadow px-6 py-3"},it={class:"flex items-center justify-between gap-4 flex-wrap"},dt={class:"flex items-center gap-2 text-sm text-gray-600"},ct={class:"px-3 py-1 bg-primary-100 text-primary-800 rounded-full font-medium"},ut=["disabled"],gt={key:0,class:"mt-3 px-6 py-2 bg-orange-50 border border-orange-200 rounded-lg"},pt={class:"text-sm"},mt={class:"cursor-pointer text-orange-800 font-medium hover:text-orange-900"},xt={class:"mt-2 flex flex-wrap gap-2"},yt={key:0,class:"px-8 py-12 text-center"},ht={key:1,class:"px-8 py-12"},ft={class:"bg-red-50 border border-red-200 rounded-lg p-6 text-center"},vt={class:"text-red-600 text-sm mt-2"},bt={key:2,class:"px-8 pb-8 space-y-6"},wt={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},_t={class:"bg-gradient-to-br from-orange-500 to-orange-700 rounded-lg shadow-lg p-6"},Ct={class:"text-4xl font-bold text-white mt-2"},kt={class:"text-orange-100 text-xs mt-2"},Mt={class:"bg-white rounded-lg shadow-md p-6"},Tt={class:"text-3xl font-bold text-gray-900 mt-2"},Ft={class:"bg-white rounded-lg shadow-md p-6"},St={class:"text-3xl font-bold text-gray-900 mt-2"},It={class:"bg-white rounded-lg shadow-lg p-6"},Dt={class:"h-80"},Lt={class:"bg-white rounded-lg shadow-lg overflow-hidden"},Bt={class:"overflow-x-auto"},Et={class:"min-w-full divide-y divide-gray-200"},At={class:"bg-gray-100"},Rt={class:"bg-white divide-y divide-gray-200"},Ot={class:"px-6 py-4 whitespace-nowrap sticky left-0 bg-white"},Nt={class:"flex items-center gap-2"},$t={class:"text-lg"},zt={class:"text-sm font-medium text-gray-900"},Pt={class:"px-6 py-4 whitespace-nowrap text-right font-semibold text-sm text-gray-900 bg-gray-50"},Yt={class:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-600 bg-gray-50"},jt={class:"bg-gray-100 font-bold"},Gt={class:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900 bg-gray-200"},Vt={class:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900 bg-gray-200"},Xt={key:0,class:"text-center py-12"},Jt=Q({__name:"fixed-costs",setup(qt){X.register(q,H,U,W,Z,J);const{selectedPerson:w}=tt(),{processInstallments:L}=ot(),B=b([]),M=b([]),g=b(!1),f=b(null),v=["Installments/Financing","Rent","Financing","Subscriptions/Softwares","Utilities","Business & Taxes","Investments","Insurance","Medical"],E=s=>{const t=s.toLowerCase();return v.some(a=>t.includes(a.toLowerCase()))},i=(()=>{const s=[],t=new Date;for(let a=5;a>=0;a--){const o=new Date(t.getFullYear(),t.getMonth()-a,1),u=o.getFullYear(),x=String(o.getMonth()+1).padStart(2,"0");s.push(`${u}-${x}`)}return s})(),A=s=>{const[t,a]=s.split("-");return new Date(parseInt(t),parseInt(a)-1).toLocaleDateString("pt-BR",{month:"short",year:"2-digit"})},p=d(()=>i.map(A)),R=d(()=>{let s=M.value;return w.value!=="Ambos"&&(s=s.filter(t=>t.person===w.value)),s}),_=d(()=>R.value.filter(s=>{const t=s.destination||"Sem Categoria";return E(t)})),O=s=>{const[t,a]=s.split("-");return _.value.filter(o=>{const u=new Date(o.date);return u.getFullYear()===parseInt(t)&&u.getMonth()===parseInt(a)-1})},m=d(()=>{const s={};return i.forEach(t=>{const a=O(t);s[t]=a.reduce((o,u)=>o+u.amount,0)}),s}),N=d(()=>{const s=i[i.length-1];return m.value[s]||0}),$=d(()=>{const s=i[i.length-1],[t,a]=s.split("-");return new Date(parseInt(t),parseInt(a)-1).toLocaleDateString("pt-BR",{month:"long",year:"numeric"})}),T=d(()=>Object.values(m.value).reduce((t,a)=>t+a,0)/i.length),z=d(()=>Object.values(m.value).reduce((s,t)=>s+t,0)),P=d(()=>{const s=new Set;return _.value.forEach(t=>{const a=t.destination||"Sem Categoria";s.add(a)}),s.size}),F=d(()=>{const s=new Map;_.value.forEach(a=>{const o=a.destination||"Sem Categoria",u=new Date(a.date),x=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}`;if(!i.includes(x))return;s.has(o)||s.set(o,{name:o,monthlyTotals:{},total:0,average:0});const C=s.get(o);C.monthlyTotals[x]=(C.monthlyTotals[x]||0)+a.amount,C.total+=a.amount});const t=[];return s.forEach(a=>{a.average=a.total/i.length,t.push(a)}),t.sort((a,o)=>o.total-a.total)}),Y=s=>{const t=p.value.indexOf(s);if(t===-1)return 0;const a=i[t];return m.value[a]||0},S=d(()=>({labels:p.value,datasets:[{label:"Custo Fixo Mensal",data:i.map(s=>m.value[s]||0),backgroundColor:"rgba(249, 115, 22, 0.8)",borderColor:"rgba(249, 115, 22, 1)",borderWidth:2,borderRadius:4}]})),j={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:s=>`Custo: ${c(s.parsed.y)}`}}},scales:{y:{beginAtZero:!0,ticks:{callback:s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}}}},c=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),G=s=>{const t=s.toLowerCase();return t.includes("installment")||t.includes("financing")||t.includes("parcela")?"📅":t.includes("rent")||t.includes("aluguel")?"🏠":t.includes("subscription")||t.includes("software")||t.includes("assinatura")?"💻":t.includes("utilities")||t.includes("utility")||t.includes("água")||t.includes("luz")||t.includes("gas")||t.includes("internet")?"📄":t.includes("business")||t.includes("tax")||t.includes("imposto")?"💼":t.includes("investment")||t.includes("investimento")?"📈":t.includes("insurance")||t.includes("seguro")?"🛡️":"💰"},V=s=>!s||s===0?"text-gray-400":"text-gray-900 font-medium",I=async()=>{g.value=!0,f.value=null;try{const s=await $fetch("/api/transactions");B.value=s;const t=L(s);M.value=t}catch{f.value="Não foi possível carregar os dados. Tente novamente."}finally{g.value=!1}};return et(()=>{I()}),(s,t)=>(r(),l("div",nt,[t[16]||(t[16]=e("div",{class:"bg-white shadow"},[e("div",{class:"px-8 py-6"},[e("h1",{class:"text-3xl font-bold text-gray-800"},"Histórico de Custos Fixos"),e("p",{class:"text-gray-600 mt-1"},"Análise dos últimos 6 meses de custos fixos")])],-1)),e("div",rt,[e("div",lt,[e("div",it,[e("div",dt,[t[0]||(t[0]=e("span",{class:"font-medium"},"Pessoa:",-1)),e("span",ct,n(D(w)),1)]),e("button",{onClick:I,disabled:g.value,class:"px-4 py-1.5 text-sm bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:bg-gray-400"},n(g.value?"Carregando...":"Atualizar"),9,ut)])]),v.length>0?(r(),l("div",gt,[e("details",pt,[e("summary",mt," 📌 "+n(v.length)+" categoria(s) configurada(s) como custo fixo ",1),e("div",xt,[(r(),l(y,null,h(v,a=>e("span",{key:a,class:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full border border-orange-300"},n(a),1)),64))]),t[1]||(t[1]=e("p",{class:"mt-2 text-xs text-orange-700"}," Para modificar, edite FIXED_COST_CATEGORIES em pages/fixed-costs.vue ",-1))])])):k("",!0)]),g.value?(r(),l("div",yt,[...t[2]||(t[2]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Carregando dados...",-1)])])):f.value?(r(),l("div",ht,[e("div",ft,[t[3]||(t[3]=e("p",{class:"text-red-800 font-medium"},"Erro ao carregar dados",-1)),e("p",vt,n(f.value),1)])])):(r(),l("div",bt,[e("div",wt,[e("div",_t,[t[4]||(t[4]=e("p",{class:"text-white text-sm font-medium uppercase tracking-wide opacity-90"},"Custo Fixo Atual",-1)),e("p",Ct,n(c(N.value)),1),e("p",kt,n($.value),1)]),e("div",Mt,[t[5]||(t[5]=e("p",{class:"text-gray-600 text-sm font-medium uppercase tracking-wide"},"Média Mensal",-1)),e("p",Tt,n(c(T.value)),1),t[6]||(t[6]=e("p",{class:"text-gray-500 text-xs mt-2"},"Últimos 6 meses",-1))]),e("div",Ft,[t[7]||(t[7]=e("p",{class:"text-gray-600 text-sm font-medium uppercase tracking-wide"},"Categorias Ativas",-1)),e("p",St,n(P.value),1),t[8]||(t[8]=e("p",{class:"text-gray-500 text-xs mt-2"},"Com gastos no período",-1))])]),e("div",It,[t[9]||(t[9]=e("h2",{class:"text-xl font-bold text-gray-800 mb-4"},"Evolução dos Custos Fixos",-1)),e("div",Dt,[S.value?(r(),st(D(K),{key:0,data:S.value,options:j},null,8,["data"])):k("",!0)])]),e("div",Lt,[t[15]||(t[15]=e("div",{class:"px-6 py-4 bg-gray-50 border-b border-gray-200"},[e("h2",{class:"text-xl font-bold text-gray-800"},"Detalhamento por Categoria"),e("p",{class:"text-sm text-gray-600 mt-1"},"Gastos mensais por categoria de custo fixo")],-1)),e("div",Bt,[e("table",Et,[e("thead",At,[e("tr",null,[t[10]||(t[10]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky left-0 bg-gray-100 z-10"}," Categoria ",-1)),(r(!0),l(y,null,h(p.value,a=>(r(),l("th",{key:a,class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},n(a),1))),128)),t[11]||(t[11]=e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap bg-gray-200"}," Total ",-1)),t[12]||(t[12]=e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap bg-gray-200"}," Média ",-1))])]),e("tbody",Rt,[(r(!0),l(y,null,h(F.value,a=>(r(),l("tr",{key:a.name,class:"hover:bg-gray-50 transition-colors"},[e("td",Ot,[e("div",Nt,[e("span",$t,n(G(a.name)),1),e("span",zt,n(a.name),1)])]),(r(!0),l(y,null,h(p.value,o=>(r(),l("td",{key:o,class:at(["px-6 py-4 whitespace-nowrap text-right text-sm",V(a.monthlyTotals[o])])},n(c(a.monthlyTotals[o]||0)),3))),128)),e("td",Pt,n(c(a.total)),1),e("td",Yt,n(c(a.average)),1)]))),128)),e("tr",jt,[t[13]||(t[13]=e("td",{class:"px-6 py-4 whitespace-nowrap sticky left-0 bg-gray-100 text-sm text-gray-900"}," TOTAL ",-1)),(r(!0),l(y,null,h(p.value,a=>(r(),l("td",{key:a,class:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900"},n(c(Y(a))),1))),128)),e("td",Gt,n(c(z.value)),1),e("td",Vt,n(c(T.value)),1)])])])]),F.value.length===0?(r(),l("div",Xt,[...t[14]||(t[14]=[e("p",{class:"text-gray-500"},"Nenhum custo fixo encontrado nos últimos 6 meses",-1)])])):k("",!0)])]))]))}});export{Jt as default};

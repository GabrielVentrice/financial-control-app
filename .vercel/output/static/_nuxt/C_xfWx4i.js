import{C as F,c as L,L as N,B as V,p as z,a as Y,b as j,d as O}from"./CTu12vcL.js";import{m as q,n as Q,A as y,p,q as W,c as n,a as e,t as o,v as m,b as Z,F as M,x as D,o as l,d as C,z as G,y as H,s as J}from"#entry";import{u as U}from"./BxOt9PVQ.js";const X={class:"min-h-screen bg-gray-50"},tt={class:"px-8 py-4"},et={class:"bg-white rounded-lg shadow px-6 py-3"},st={class:"flex items-center justify-between gap-4 flex-wrap"},at={class:"flex items-center gap-2 text-sm text-gray-600"},ot={class:"px-3 py-1 bg-primary-100 text-primary-800 rounded-full font-medium"},rt=["disabled"],nt={key:0,class:"px-8 py-12 text-center"},lt={key:1,class:"px-8 py-12"},it={class:"bg-red-50 border border-red-200 rounded-lg p-6 text-center"},dt={class:"text-red-600 text-sm mt-2"},ct={key:2,class:"px-8 pb-8"},pt={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"},ut={class:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow"},gt={class:"text-3xl font-bold text-gray-900 mt-2"},mt={class:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow"},ht={class:"text-3xl font-bold text-gray-900 mt-2"},xt={class:"text-xs text-gray-500 mt-1"},yt={class:"bg-gradient-to-br from-primary-500 to-primary-700 rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow"},ft={class:"text-4xl font-bold text-white mt-2"},vt={class:"bg-white rounded-lg shadow-md p-6 mb-6"},_t={class:"h-96"},bt={class:"bg-white rounded-lg shadow-md p-6 mb-6"},wt={class:"text-xl font-bold text-gray-800 mb-4"},kt={key:0,class:"text-center py-8 text-gray-500"},Mt={key:1,class:"space-y-4"},Dt={class:"flex justify-between items-start"},Ct={class:"flex-1"},At={class:"font-semibold text-gray-900 text-lg"},Bt={class:"mt-2 flex flex-wrap gap-4 text-sm"},$t={class:"text-gray-600"},Kt={class:"text-gray-600"},Tt={class:"text-right ml-4"},Pt={class:"text-2xl font-bold text-primary-600"},Rt={class:"text-xs text-gray-500 mt-1"},St={class:"mt-2"},It={class:"w-32 bg-gray-200 rounded-full h-2"},Et={class:"mt-3 grid grid-cols-2 gap-2 text-xs"},Ft={class:"bg-gray-50 rounded p-2"},Lt={class:"font-medium text-gray-900 ml-1"},Nt={class:"bg-gray-50 rounded p-2"},Vt={class:"font-medium text-gray-900 ml-1"},zt={class:"bg-white rounded-lg shadow-md p-6"},Yt={class:"overflow-x-auto"},jt={class:"min-w-full divide-y divide-gray-200"},Ot={class:"bg-white divide-y divide-gray-200"},qt={class:"px-6 py-4 whitespace-nowrap"},Qt={class:"flex items-center"},Wt={key:0,class:"mr-2 px-2 py-1 text-xs font-semibold rounded-full bg-primary-600 text-white"},Zt={class:"text-sm font-medium text-gray-900"},Gt={class:"px-6 py-4 whitespace-nowrap"},Ht={class:"px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800"},Jt={class:"px-6 py-4 whitespace-nowrap"},Ut={class:"text-lg font-bold text-primary-600"},ne=q({__name:"installments",setup(Xt){F.register(L,N,V,z,Y,j);const{selectedPerson:f}=Q(),{processInstallments:A,parseInstallment:B,isInstallmentTransaction:$}=U(),K=y([]),_=y([]),u=y(!1),h=y(null),i=(()=>{const s=new Date;return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`})(),T=(()=>{const s=[],t=new Date;for(let a=-6;a<=6;a++){const r=new Date(t.getFullYear(),t.getMonth()+a,1),c=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;s.push(c)}return s})(),b=p(()=>{let s=_.value.filter(t=>$(t));return f.value!=="Ambos"&&(s=s.filter(t=>t.person===f.value)),s}),P=p(()=>{const s=new Map;return b.value.forEach(t=>{const a=B(t.description);if(!a)return;const r=`${a.description}_${t.origin}_${a.total}`;s.has(r)||s.set(r,{key:r,description:a.description,origin:t.origin,amount:t.amount,total:a.total,paid:0,remaining:a.total,firstDate:t.date,lastDate:t.date,transactions:[]});const c=s.get(r);c.transactions.push(t),t.date<c.firstDate&&(c.firstDate=t.date),t.date>c.lastDate&&(c.lastDate=t.date),t.date.substring(0,7)<=i&&c.paid++}),s.forEach(t=>{t.remaining=t.total-t.paid}),Array.from(s.values())}),x=p(()=>P.value.filter(s=>s.remaining>0).sort((s,t)=>t.remaining-s.remaining)),d=p(()=>{const s=new Map;return T.forEach(t=>{s.set(t,{monthKey:t,count:0,total:0})}),b.value.forEach(t=>{const a=t.date.substring(0,7);if(s.has(a)){const r=s.get(a);r.count++,r.total+=t.amount}}),Array.from(s.values())}),R=p(()=>d.value.find(t=>t.monthKey===i)?.total||0),S=p(()=>d.value.reduce((t,a)=>t+a.total,0)/d.value.length),I=p(()=>({labels:d.value.map(s=>v(s.monthKey)),datasets:[{label:"Total de Parcelas",data:d.value.map(s=>s.total),backgroundColor:d.value.map(s=>s.monthKey===i?"rgba(37, 99, 235, 0.8)":s.monthKey<i?"rgba(156, 163, 175, 0.6)":"rgba(59, 130, 246, 0.5)"),borderColor:d.value.map(s=>s.monthKey===i?"rgb(29, 78, 216)":s.monthKey<i?"rgb(107, 114, 128)":"rgb(37, 99, 235)"),borderWidth:2}]})),E={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!1},tooltip:{callbacks:{label:s=>{const t=s.parsed.y;return`Total: ${g(t)}`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:s=>`R$ ${s.toLocaleString("pt-BR")}`}}}},g=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),w=s=>{if(!s)return"-";try{return new Date(s).toLocaleDateString("pt-BR")}catch{return s}},v=s=>{const[t,a]=s.split("-");return new Date(parseInt(t),parseInt(a)-1).toLocaleDateString("pt-BR",{month:"short",year:"numeric"})},k=async()=>{u.value=!0,h.value=null;try{const s=await $fetch("/api/transactions");K.value=s;const t=A(s);_.value=t}catch{h.value="Não foi possível carregar os dados. Tente novamente."}finally{u.value=!1}};return W(()=>{k()}),(s,t)=>(l(),n("div",X,[t[16]||(t[16]=e("div",{class:"bg-white shadow"},[e("div",{class:"px-8 py-6"},[e("h1",{class:"text-3xl font-bold text-gray-800"},"Análise de Parcelas"),e("p",{class:"text-gray-600 mt-1"},"Visualize parcelas passadas e futuras por período")])],-1)),e("div",tt,[e("div",et,[e("div",st,[e("div",at,[t[0]||(t[0]=e("span",{class:"font-medium"},"Pessoa:",-1)),e("span",ot,o(m(f)),1)]),e("button",{onClick:k,disabled:u.value,class:"px-4 py-1.5 text-sm bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:bg-gray-400"},o(u.value?"Carregando...":"Atualizar"),9,rt)])])]),u.value?(l(),n("div",nt,[...t[1]||(t[1]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Carregando dados...",-1)])])):h.value?(l(),n("div",lt,[e("div",it,[t[2]||(t[2]=e("p",{class:"text-red-800 font-medium"},"Erro ao carregar dados",-1)),e("p",dt,o(h.value),1)])])):(l(),n("div",ct,[e("div",pt,[e("div",ut,[t[3]||(t[3]=e("p",{class:"text-gray-600 text-sm font-medium uppercase tracking-wide"},"Parcelas Ativas",-1)),e("p",gt,o(x.value.length),1),t[4]||(t[4]=e("p",{class:"text-xs text-gray-500 mt-1"},"Com parcelas futuras",-1))]),e("div",mt,[t[5]||(t[5]=e("p",{class:"text-gray-600 text-sm font-medium uppercase tracking-wide"},"Total Mês Atual",-1)),e("p",ht,o(g(R.value)),1),e("p",xt,o(v(m(i))),1)]),e("div",yt,[t[6]||(t[6]=e("p",{class:"text-white text-sm font-medium uppercase tracking-wide opacity-90"},"Média Mensal",-1)),e("p",ft,o(g(S.value)),1),t[7]||(t[7]=e("p",{class:"text-xs text-white opacity-80 mt-1"},"Últimos 13 meses",-1))])]),e("div",vt,[t[8]||(t[8]=e("h2",{class:"text-xl font-bold text-gray-800 mb-4"},"Parcelas por Mês (6 meses atrás → 6 meses à frente)",-1)),e("div",_t,[Z(m(O),{data:I.value,options:E},null,8,["data"])])]),e("div",bt,[e("h2",wt,"Parcelas Ativas ("+o(x.value.length)+")",1),x.value.length===0?(l(),n("div",kt,[...t[9]||(t[9]=[e("p",null,"Nenhuma parcela ativa encontrada",-1)])])):(l(),n("div",Mt,[(l(!0),n(M,null,D(x.value,a=>(l(),n("div",{key:a.key,class:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow"},[e("div",Dt,[e("div",Ct,[e("h3",At,o(a.description),1),e("div",Bt,[e("span",$t,[t[10]||(t[10]=e("span",{class:"font-medium"},"Origem:",-1)),C(" "+o(a.origin),1)]),e("span",Kt,[t[11]||(t[11]=e("span",{class:"font-medium"},"Valor:",-1)),C(" "+o(g(a.amount))+"/mês ",1)])])]),e("div",Tt,[e("div",Pt,o(a.paid)+"/"+o(a.total),1),e("div",Rt,o(a.remaining)+" restantes ",1),e("div",St,[e("div",It,[e("div",{class:"bg-primary-600 h-2 rounded-full transition-all",style:G({width:`${a.paid/a.total*100}%`})},null,4)])])])]),e("div",Et,[e("div",Ft,[t[12]||(t[12]=e("span",{class:"text-gray-600"},"Primeira parcela:",-1)),e("span",Lt,o(w(a.firstDate)),1)]),e("div",Nt,[t[13]||(t[13]=e("span",{class:"text-gray-600"},"Última parcela:",-1)),e("span",Vt,o(w(a.lastDate)),1)])])]))),128))]))]),e("div",zt,[t[15]||(t[15]=e("h2",{class:"text-xl font-bold text-gray-800 mb-4"},"Detalhamento Mensal",-1)),e("div",Yt,[e("table",jt,[t[14]||(t[14]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Mês "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Qtd. Parcelas "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Total ")])],-1)),e("tbody",Ot,[(l(!0),n(M,null,D(d.value,a=>(l(),n("tr",{key:a.monthKey,class:H(["hover:bg-gray-50 transition-colors",{"bg-primary-50":a.monthKey===m(i)}])},[e("td",qt,[e("div",Qt,[a.monthKey===m(i)?(l(),n("span",Wt," Atual ")):J("",!0),e("span",Zt,o(v(a.monthKey)),1)])]),e("td",Gt,[e("span",Ht,o(a.count),1)]),e("td",Jt,[e("div",Ut,o(g(a.total)),1)])],2))),128))])])])])]))]))}});export{ne as default};

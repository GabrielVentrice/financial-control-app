import{j as $,k as U,l as q,r as N,m as J,n as O,p as A,q as G,c as b,o as y,a as t,s as B,t as c,v as S,F as Y,x as P,y as E,d as K,b as R,z as W,w as V,e as Z}from"#entry";import{C as H,p as Q,a as X,b as tt,B as et,c as st,L as ot,d as nt}from"./CTu12vcL.js";const at="$s";function I(...x){const w=typeof x[x.length-1]=="string"?x.pop():void 0;typeof x[0]!="string"&&x.unshift(w);const[p,_]=x;if(!p||typeof p!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+p);if(_!==void 0&&typeof _!="function")throw new Error("[nuxt] [useState] init must be a function: "+_);const k=at+p,C=$(),T=U(C.payload.state,k);if(T.value===void 0&&_){const r=_();if(q(r))return C.payload.state[k]=r,r;T.value=r}return T}const rt=()=>{const x=I("transactions",()=>[]),w=I("transactions-loading",()=>!1),p=I("transactions-error",()=>null),_=async e=>{w.value=!0,p.value=null;try{const o=new URLSearchParams;e?.person&&o.append("person",e.person),e?.startDate&&o.append("startDate",e.startDate),e?.endDate&&o.append("endDate",e.endDate),e?.searchTerm&&o.append("searchTerm",e.searchTerm),e?.origin&&o.append("origin",e.origin),e?.destination&&o.append("destination",e.destination),e?.processInstallments!==void 0&&o.append("processInstallments",String(e.processInstallments));const l=o.toString()?`/api/transactions?${o.toString()}`:"/api/transactions",n=await $fetch(l);x.value=n}catch(o){p.value=o.message||"Erro ao carregar transações",console.error("Erro ao buscar transações:",o)}finally{w.value=!1}},k=e=>(e||x.value).reduce((l,n)=>l+n.amount,0),C=(e,o)=>x.value.filter(l=>{const n=new Date(l.date),i=new Date(e),h=new Date(o);return n>=i&&n<=h}),T=e=>x.value.filter(o=>o.origin.toLowerCase().includes(e.toLowerCase())),r=e=>x.value.filter(o=>o.description.toLowerCase().includes(e.toLowerCase()));return{transactions:N(x),loading:N(w),error:N(p),fetchTransactions:_,getTransactionsByDateRange:C,getTotalAmount:k,getTransactionsByOrigin:T,getTransactionsByDescription:r}},lt=()=>{const x=r=>r.destination.toLowerCase().includes("bank account"),w=r=>{const e=r.origin.toLowerCase();return e.includes("bank account")||e.includes("credit card")},p=r=>{const e=new Date,o=e.getMonth(),l=e.getFullYear(),n=r.filter(d=>{const m=new Date(d.date);return m.getMonth()===o&&m.getFullYear()===l}),i=n.filter(d=>x(d)).reduce((d,m)=>d+Math.abs(m.amount),0),h=n.filter(d=>w(d)).reduce((d,m)=>d+Math.abs(m.amount),0);return{income:i,expenses:h,balance:i-h,transactionCount:n.length}},_=(r,e=5)=>{const o=new Date,l=o.getMonth(),n=o.getFullYear(),i=r.filter(u=>{const g=new Date(u.date);return g.getMonth()===l&&g.getFullYear()===n&&w(u)}),h=new Map;i.forEach(u=>{const g=u.destination||"Sem categoria",F=h.get(g)||{total:0,count:0};h.set(g,{total:F.total+Math.abs(u.amount),count:F.count+1})});const d=Array.from(h.values()).reduce((u,g)=>u+g.total,0);return Array.from(h.entries()).map(([u,g])=>({name:u,total:g.total,count:g.count,percentage:d>0?g.total/d*100:0})).sort((u,g)=>g.total-u.total).slice(0,e)},k=r=>{const e=new Date,o=new Date(e);return o.setMonth(o.getMonth()+1),r.filter(l=>{const n=new Date(l.date);return n>e&&n<=o&&w(l)}).sort((l,n)=>new Date(l.date).getTime()-new Date(n.date).getTime())};return{getCurrentMonthStats:p,getTopCategories:_,getUpcomingExpenses:k,generateAlerts:r=>{const e=[],o=new Date,l=o.getMonth(),n=o.getFullYear(),i=p(r),d=r.filter(v=>{const M=new Date(v.date),D=l===0?11:l-1,L=l===0?n-1:n;return M.getMonth()===D&&M.getFullYear()===L}).filter(v=>w(v)).reduce((v,M)=>v+Math.abs(M.amount),0);d>0&&i.expenses>d*1.2&&e.push({type:"warning",title:"Gastos Acima do Esperado",message:"Seus gastos estão 20% acima do mês passado",amount:i.expenses-d});const m=r.filter(v=>{const M=new Date(v.date);return M.getMonth()===l&&M.getFullYear()===n&&Math.abs(v.amount)>1e3});m.length>0&&e.push({type:"info",title:"Transações de Alto Valor",message:`${m.length} transação(ões) acima de R$ 1.000`,amount:m.reduce((v,M)=>v+Math.abs(M.amount),0)}),i.balance<0&&e.push({type:"danger",title:"Saldo Negativo",message:"Suas despesas estão maiores que sua receita este mês",amount:Math.abs(i.balance)});const u=new Date(n,l+1,0).getDate(),g=o.getDate(),F=g/u*20;return i.transactionCount<F*.5&&g>10&&e.push({type:"warning",title:"Poucas Transações Registradas",message:"Você pode ter transações não registradas este mês"}),e},getMonthlyForecast:r=>{const e=new Date,o=new Date(e);o.setMonth(o.getMonth()+1);const l=k(r),n=l.reduce((u,g)=>u+Math.abs(g.amount),0),i=p(r),h=new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),d=e.getDate(),m=d>5?i.income/d*h:i.income;return{projectedIncome:m,upcomingExpenses:n,projectedBalance:m-n,upcomingCount:l.length}}}},it={class:"min-h-screen bg-gray-50"},dt={class:"bg-gradient-to-r from-primary-600 to-primary-700 shadow-lg"},ct={class:"px-8 py-8"},ut={class:"flex items-center justify-between"},gt={class:"text-primary-100 mt-1"},pt=["disabled"],mt={key:0,class:"px-8 py-12 text-center"},xt={key:1,class:"px-8 pt-8"},bt={class:"bg-red-50 border border-red-200 rounded-lg p-6 text-center"},yt={class:"text-red-600 text-sm mt-2"},ht={key:2,class:"px-8 py-8 space-y-6"},ft={key:0,class:"space-y-3"},vt={class:"flex-1"},wt={key:0,class:"font-medium"},_t={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Dt={class:"bg-white rounded-lg shadow-md p-6 border-l-4 border-primary-500"},Mt={class:"text-gray-500 text-xs mt-2"},kt={class:"bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500"},Ct={class:"text-4xl font-bold text-green-600 mt-3"},Tt={class:"bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500"},St={class:"text-4xl font-bold text-red-600 mt-3"},At={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Ft={class:"bg-white rounded-lg shadow-md p-6"},Et={class:"h-64"},Bt={class:"bg-white rounded-lg shadow-md p-6"},Rt={key:0,class:"space-y-4"},Lt={class:"flex justify-between items-center"},jt={class:"text-sm font-medium text-gray-700 truncate"},Nt={class:"text-sm font-bold text-gray-900"},Yt={class:"w-full bg-gray-200 rounded-full h-2.5"},Pt={class:"flex justify-between text-xs text-gray-500"},Vt={key:1,class:"text-center py-8 text-gray-500"},It={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},zt={class:"lg:col-span-2 bg-white rounded-lg shadow-md p-6"},$t={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Ut={class:"bg-green-50 rounded-lg p-4"},qt={class:"text-2xl font-bold text-green-600 mt-1"},Jt={class:"bg-red-50 rounded-lg p-4"},Ot={class:"text-2xl font-bold text-red-600 mt-1"},Gt={class:"bg-blue-50 rounded-lg p-4"},Kt={key:0,class:"border-t pt-4"},Wt={class:"text-sm font-semibold text-gray-700 mb-3"},Zt={class:"space-y-2 max-h-48 overflow-y-auto"},Ht={class:"flex-1"},Qt={class:"font-medium text-gray-700"},Xt={class:"text-xs text-gray-500"},te={class:"font-bold text-red-600 ml-4"},ee={key:1,class:"border-t pt-4 text-center text-gray-500 text-sm"},se={class:"bg-white rounded-lg shadow-md p-6"},oe={class:"space-y-3"},ne={class:"mt-6 p-3 bg-gray-50 rounded-lg border border-gray-200"},ae={class:"inline-block px-3 py-1 bg-primary-100 text-primary-800 rounded-full text-sm font-semibold"},ie=J({__name:"index",setup(x){H.register(Q,X,tt,et,st,ot);const{transactions:w,loading:p,error:_,fetchTransactions:k}=rt(),{selectedPerson:C}=O(),{getCurrentMonthStats:T,getTopCategories:r,getUpcomingExpenses:e,generateAlerts:o,getMonthlyForecast:l}=lt(),n=A(()=>{let f=w.value;return C.value!=="Ambos"&&(f=f.filter(s=>s.person===C.value)),f}),i=A(()=>T(n.value)),h=A(()=>r(n.value,5)),d=A(()=>e(n.value)),m=A(()=>o(n.value)),u=A(()=>l(n.value)),g=A(()=>({labels:["Receitas","Despesas"],datasets:[{label:"Valores do Mês",data:[i.value.income,i.value.expenses],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgb(34, 197, 94)","rgb(239, 68, 68)"],borderWidth:2}]})),F={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:f=>D(f.parsed.y)}}},scales:{y:{beginAtZero:!0,ticks:{callback:f=>"R$ "+f.toLocaleString("pt-BR")}}}},v=async()=>{await k()},M=f=>{if(!f)return"-";try{return new Date(f).toLocaleDateString("pt-BR")}catch{return f}},D=f=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(f),L=()=>["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"][new Date().getMonth()];return G(()=>{k()}),(f,s)=>{const j=Z;return y(),b("div",it,[t("div",dt,[t("div",ct,[t("div",ut,[t("div",null,[s[0]||(s[0]=t("h1",{class:"text-3xl font-bold text-white"},"Dashboard Financeiro",-1)),t("p",gt,c(L())+" - Visão geral rápida",1)]),t("button",{onClick:v,disabled:S(p),class:"px-6 py-2 bg-white text-primary-700 rounded-lg hover:bg-primary-50 transition-colors disabled:bg-gray-400 disabled:text-gray-600 font-medium shadow-md"},c(S(p)?"Atualizando...":"Atualizar"),9,pt)])])]),S(p)?(y(),b("div",mt,[...s[1]||(s[1]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"},null,-1),t("p",{class:"mt-4 text-gray-600"},"Carregando dados financeiros...",-1)])])):B("",!0),S(_)?(y(),b("div",xt,[t("div",bt,[s[2]||(s[2]=t("p",{class:"text-red-800 font-medium"},"Erro ao carregar dados",-1)),t("p",yt,c(S(_)),1)])])):S(p)?B("",!0):(y(),b("div",ht,[m.value.length>0?(y(),b("div",ft,[(y(!0),b(Y,null,P(m.value,(a,z)=>(y(),b("div",{key:z,class:E([{"bg-yellow-50 border-yellow-200":a.type==="warning","bg-red-50 border-red-200":a.type==="danger","bg-blue-50 border-blue-200":a.type==="info"},"border rounded-lg p-4 flex items-start gap-3"])},[t("div",{class:E([{"text-yellow-600":a.type==="warning","text-red-600":a.type==="danger","text-blue-600":a.type==="info"},"text-xl mt-0.5"])},c(a.type==="danger"?"⚠️":a.type==="warning"?"⚡":"ℹ️"),3),t("div",vt,[t("p",{class:E([{"text-yellow-900":a.type==="warning","text-red-900":a.type==="danger","text-blue-900":a.type==="info"},"font-semibold"])},c(a.title),3),t("p",{class:E([{"text-yellow-700":a.type==="warning","text-red-700":a.type==="danger","text-blue-700":a.type==="info"},"text-sm mt-1"])},[K(c(a.message)+" ",1),a.amount?(y(),b("span",wt," ("+c(D(a.amount))+") ",1)):B("",!0)],2)])],2))),128))])):B("",!0),t("div",_t,[t("div",Dt,[s[3]||(s[3]=t("p",{class:"text-gray-600 text-sm font-medium uppercase tracking-wide"},"Saldo do Mês",-1)),t("p",{class:E([{"text-green-600":i.value.balance>=0,"text-red-600":i.value.balance<0},"text-4xl font-bold mt-3"])},c(D(i.value.balance)),3),t("p",Mt,c(i.value.transactionCount)+" transações ",1)]),t("div",kt,[s[4]||(s[4]=t("p",{class:"text-gray-600 text-sm font-medium uppercase tracking-wide"},"Receitas",-1)),t("p",Ct,c(D(i.value.income)),1),s[5]||(s[5]=t("p",{class:"text-gray-500 text-xs mt-2"},"Entradas do mês",-1))]),t("div",Tt,[s[6]||(s[6]=t("p",{class:"text-gray-600 text-sm font-medium uppercase tracking-wide"},"Despesas",-1)),t("p",St,c(D(i.value.expenses)),1),s[7]||(s[7]=t("p",{class:"text-gray-500 text-xs mt-2"},"Saídas do mês",-1))])]),t("div",At,[t("div",Ft,[s[8]||(s[8]=t("h2",{class:"text-lg font-bold text-gray-800 mb-4"},"Receitas vs Despesas",-1)),t("div",Et,[R(S(nt),{data:g.value,options:F},null,8,["data"])])]),t("div",Bt,[s[9]||(s[9]=t("h2",{class:"text-lg font-bold text-gray-800 mb-4"},"Top Categorias de Gastos",-1)),h.value.length>0?(y(),b("div",Rt,[(y(!0),b(Y,null,P(h.value,a=>(y(),b("div",{key:a.name,class:"space-y-2"},[t("div",Lt,[t("span",jt,c(a.name),1),t("span",Nt,c(D(a.total)),1)]),t("div",Yt,[t("div",{class:"bg-primary-600 h-2.5 rounded-full transition-all duration-300",style:W({width:a.percentage+"%"})},null,4)]),t("div",Pt,[t("span",null,c(a.count)+" transações",1),t("span",null,c(a.percentage.toFixed(1))+"%",1)])]))),128))])):(y(),b("div",Vt," Nenhuma categoria de gasto este mês "))])]),t("div",It,[t("div",zt,[s[13]||(s[13]=t("h2",{class:"text-lg font-bold text-gray-800 mb-4"},"Previsão Mensal",-1)),t("div",$t,[t("div",Ut,[s[10]||(s[10]=t("p",{class:"text-sm text-green-700 font-medium"},"Receita Projetada",-1)),t("p",qt,c(D(u.value.projectedIncome)),1)]),t("div",Jt,[s[11]||(s[11]=t("p",{class:"text-sm text-red-700 font-medium"},"Despesas Futuras",-1)),t("p",Ot,c(D(u.value.upcomingExpenses)),1)]),t("div",Gt,[s[12]||(s[12]=t("p",{class:"text-sm text-blue-700 font-medium"},"Saldo Projetado",-1)),t("p",{class:E([{"text-green-600":u.value.projectedBalance>=0,"text-red-600":u.value.projectedBalance<0},"text-2xl font-bold mt-1"])},c(D(u.value.projectedBalance)),3)])]),d.value.length>0?(y(),b("div",Kt,[t("h3",Wt," Próximas Despesas ("+c(d.value.length)+") ",1),t("div",Zt,[(y(!0),b(Y,null,P(d.value.slice(0,5),a=>(y(),b("div",{key:a.transactionId,class:"flex justify-between items-center text-sm py-2 border-b border-gray-100 last:border-0"},[t("div",Ht,[t("p",Qt,c(a.description),1),t("p",Xt,c(M(a.date)),1)]),t("span",te,c(D(Math.abs(a.amount))),1)]))),128))])])):(y(),b("div",ee," Nenhuma despesa futura programada "))]),t("div",se,[s[19]||(s[19]=t("h2",{class:"text-lg font-bold text-gray-800 mb-4"},"Ações Rápidas",-1)),t("div",oe,[R(j,{to:"/transactions",class:"flex items-center gap-3 p-4 bg-primary-50 hover:bg-primary-100 rounded-lg transition-colors border border-primary-200"},{default:V(()=>[...s[14]||(s[14]=[t("div",{class:"text-2xl"},"📝",-1),t("div",null,[t("p",{class:"font-semibold text-primary-900 text-sm"},"Ver Transações"),t("p",{class:"text-xs text-primary-700"},"Lista completa")],-1)])]),_:1}),R(j,{to:"/categories",class:"flex items-center gap-3 p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors border border-purple-200"},{default:V(()=>[...s[15]||(s[15]=[t("div",{class:"text-2xl"},"📊",-1),t("div",null,[t("p",{class:"font-semibold text-purple-900 text-sm"},"Categorias"),t("p",{class:"text-xs text-purple-700"},"Análise detalhada")],-1)])]),_:1}),R(j,{to:"/installments",class:"flex items-center gap-3 p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition-colors border border-orange-200"},{default:V(()=>[...s[16]||(s[16]=[t("div",{class:"text-2xl"},"💳",-1),t("div",null,[t("p",{class:"font-semibold text-orange-900 text-sm"},"Parcelamentos"),t("p",{class:"text-xs text-orange-700"},"Timeline e análise")],-1)])]),_:1}),t("button",{onClick:v,class:"w-full flex items-center gap-3 p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200"},[...s[17]||(s[17]=[t("div",{class:"text-2xl"},"🔄",-1),t("div",{class:"text-left"},[t("p",{class:"font-semibold text-gray-900 text-sm"},"Atualizar Dados"),t("p",{class:"text-xs text-gray-700"},"Sincronizar planilha")],-1)])])]),t("div",ne,[s[18]||(s[18]=t("p",{class:"text-xs font-medium text-gray-600 mb-1"},"Filtro Atual:",-1)),t("span",ae,c(S(C)),1)])])])]))])}}});export{ie as default};
